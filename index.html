<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DABBADOO DELUXE EDITION</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Black+Ops+One&family=Press+Start+2P&display=swap');
        body { margin: 0; overflow: hidden; background: #000; touch-action: none; font-family: 'Press Start 2P', cursive; user-select: none; }
        
        /* UI STYLING */
        #hud { position: absolute; top: 20px; left: 20px; z-index: 10; pointer-events: none; }
        .stat { background: rgba(255, 0, 68, 0.2); border: 3px solid #ff0044; padding: 10px; color: #fff; font-size: 12px; margin-bottom: 10px; box-shadow: 5px 5px 0px #000; }
        #crosshair { position: fixed; top: 50%; left: 50%; width: 20px; height: 20px; border: 2px solid #0f0; border-radius: 50%; transform: translate(-50%, -50%); pointer-events: none; z-index: 100; }
        #crosshair::after { content: ''; position: absolute; top: 50%; left: 50%; width: 4px; height: 4px; background: #0f0; transform: translate(-50%, -50%); }

        /* CONTROLS */
        .btn { position: absolute; z-index: 20; border: 4px solid #fff; color: #fff; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.8); font-family: 'Black Ops One'; font-size: 20px; box-shadow: 6px 6px 0px #ff0044; }
        #jump-btn { bottom: 120px; right: 30px; width: 80px; height: 80px; border-radius: 50%; }
        #shoot-btn { bottom: 20px; right: 20px; width: 120px; height: 120px; background: #ff0044; }
        #joy-base { position: absolute; bottom: 40px; left: 40px; width: 120px; height: 120px; background: rgba(255,255,255,0.1); border: 4px solid #fff; border-radius: 50%; }
        #joy-knob { position: absolute; top: 30px; left: 30px; width: 60px; height: 60px; background: #ff0044; border-radius: 50%; border: 3px solid #fff; }

        /* SCREENS */
        .screen { position: fixed; inset: 0; background: #000; z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #fff; text-align: center; }
        h1 { font-size: 40px; color: #ff0044; margin: 0; text-shadow: 4px 4px #000; }
        .glitch { animation: glitch 0.3s infinite; }
        @keyframes glitch { 0% { transform: translate(2px, 2px); } 50% { transform: translate(-2px, -2px); } 100% { transform: translate(0); } }
        button { background: #0f0; color: #000; border: 5px solid #fff; padding: 20px 40px; font-family: 'Black Ops One'; font-size: 24px; cursor: pointer; margin-top: 20px; }
    </style>
</head>
<body>

    <div id="start-screen" class="screen">
        <h1 class="glitch">DABBADOO</h1>
        <p>3D FPS SHOOTER DELUXE</p>
        <div style="color: #888; font-size: 10px; margin-top: 10px;">POWERED BY BOBOB MACHINEâ„¢</div>
        <button id="start-btn">GRIND NOW</button>
    </div>

    <div id="hud">
        <div class="stat">VULVIAN HP: <span id="hp">100</span>%</div>
        <div class="stat" id="snot-alert" style="display:none; color:#0f0">SNOT RELOAD!</div>
    </div>

    <div id="crosshair"></div>
    <div id="joy-base"><div id="joy-knob"></div></div>
    <div id="jump-btn" class="btn">JUMP</div>
    <div id="shoot-btn" class="btn">FIRE</div>

    <script src="https://unpkg.com/three@0.155.0/build/three.min.js"></script>
    <script>
        /** --- THE ENGINE --- **/
        let scene, camera, renderer, clock;
        let arms, gun, muzzleFlash;
        let platforms = [], enemies = [], bullets = [], particles = [];
        let hp = 100, isPlaying = false;
        let move = {x:0, y:0}, look = {x:0, y:0}, velY = 0, jumps = 0;
        let touchIds = {move:null, look:null, lx:0, ly:0};
        let shots = 0;

        const BOX = (w,h,d,col) => new THREE.Mesh(new THREE.BoxGeometry(w,h,d), new THREE.MeshStandardMaterial({color:col}));

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x050005);
            scene.fog = new THREE.FogExp2(0x110011, 0.02);
            clock = new THREE.Clock();
            
            camera = new THREE.PerspectiveCamera(80, window.innerWidth/window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({antialias: true});
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            const ambient = new THREE.AmbientLight(0xffffff, 0.5);
            const sun = new THREE.PointLight(0xff0044, 2, 100);
            sun.position.set(0, 50, 0);
            scene.add(ambient, sun);

            // VULVIAN ARMS
            arms = new THREE.Group();
            const L_Arm = BOX(0.3, 0.8, 0.3, 0xffffff);
            const R_Arm = BOX(0.3, 0.8, 0.3, 0xffffff);
            L_Arm.position.set(-0.6, -0.5, -0.2);
            R_Arm.position.set(0.6, -0.5, -0.2);
            L_Arm.rotation.x = R_Arm.rotation.x = Math.PI/3;
            
            // Black Tactical Gloves
            const L_Glove = BOX(0.32, 0.2, 0.32, 0x111111);
            const R_Glove = BOX(0.32, 0.2, 0.32, 0x111111);
            L_Glove.position.y = -0.4; R_Glove.position.y = -0.4;
            L_Arm.add(L_Glove); R_Arm.add(R_Glove);

            // THE GUN (DAB-15)
            gun = new THREE.Group();
            const gBody = BOX(0.2, 0.3, 1.2, 0x222222);
            const gMag = BOX(0.15, 0.5, 0.2, 0x00ff00); // Green Snot Mag
            gMag.position.set(0, -0.3, 0.2);
            muzzleFlash = new THREE.PointLight(0x00ff00, 0, 5);
            muzzleFlash.position.z = -0.8;
            gun.add(gBody, gMag, muzzleFlash);
            gun.position.set(0, -0.2, -0.5);
            R_Arm.add(gun);

            arms.add(L_Arm, R_Arm);
            camera.add(arms);
            scene.add(camera);

            buildWorld();
            setupControls();
            loop();
        }

        // --- BLOCKY BOOBI DOODI MODEL ---
        function createBoobi(x,y,z) {
            const b = new THREE.Group();
            const legs = BOX(1, 1.2, 0.6, 0x0000ff); // Blue pants
            const torso = BOX(1.1, 1.2, 0.7, 0xff0000); // Red shirt
            torso.position.y = 1.2;
            const stripe = BOX(1.12, 0.3, 0.72, 0xffffff); // White stripe
            torso.add(stripe);
            
            const head = BOX(0.9, 0.9, 0.9, 0xffccaa);
            head.position.y = 2.2;
            
            // Hair & Daisy
            const hair = BOX(1, 0.3, 1, 0x442200);
            hair.position.y = 0.5;
            const flower = BOX(0.2, 0.4, 0.2, 0xffff00);
            flower.position.set(0.3, 0.3, 0);
            head.add(hair, flower);

            // Glasses
            const glasses = BOX(0.7, 0.2, 0.1, 0x000000);
            glasses.position.set(0, 0, 0.46);
            head.add(glasses);

            b.add(legs, torso, head);
            b.position.set(x,y,z);
            scene.add(b);
            return b;
        }

        // --- THE BOOBASTA (ROBLOX STYLE) ---
        function spawnBoobasta(x,y,z) {
            const mob = new THREE.Group();
            const body = BOX(1.2, 2, 0.8, 0x888888); // Gray Body
            body.position.y = 1;
            const head = BOX(1, 1, 1, 0xffffff); // White Face
            head.position.y = 2.5;
            const smirk = BOX(0.6, 0.1, 0.1, 0x000000);
            smirk.position.set(0, -0.2, 0.5);
            smirk.rotation.z = 0.1;
            head.add(smirk);
            
            mob.add(body, head);
            mob.position.set(x,y,z);
            mob.userData = { hp: 3, speed: 0.05 + Math.random()*0.05, velY: 0 };
            scene.add(mob);
            enemies.push(mob);
        }

        function buildWorld() {
            // Platforms
            const mat = new THREE.MeshStandardMaterial({color: 0x222222});
            const createPlat = (x,y,z,w,d) => {
                const p = BOX(w, 1, d, 0x222222);
                p.position.set(x,y,z);
                p.userData = { xMin: x-w/2, xMax: x+w/2, zMin: z-d/2, zMax: z+d/2, y: y+0.5 };
                scene.add(p);
                platforms.push(p);
                // Randomly spawn Boobastas on new platforms
                if(z < -10) {
                    for(let i=0; i<2; i++) spawnBoobasta(x+(Math.random()-0.5)*w, y+1, z+(Math.random()-0.5)*d);
                }
            };

            createPlat(0, 0, 0, 15, 15); // Start
            createPlat(5, 3, -20, 10, 10);
            createPlat(-5, 6, -40, 12, 12);
            createPlat(0, 8, -65, 15, 15); // Goal

            createBoobi(0, 8.5, -65);
        }

        function shoot() {
            shots++;
            muzzleFlash.intensity = 5;
            const b = BOX(0.1, 0.1, 0.5, 0xffff00);
            b.position.copy(camera.position);
            const dir = new THREE.Vector3(0,0,-1).applyQuaternion(camera.quaternion);
            b.userData = { v: dir.multiplyScalar(2) };
            scene.add(b);
            bullets.push(b);

            if(shots % 10 === 0) {
                document.getElementById('snot-alert').style.display = 'block';
                setTimeout(()=>document.getElementById('snot-alert').style.display='none', 1000);
            }
        }

        function setupControls() {
            const joy = document.getElementById('joy-base'), knob = document.getElementById('joy-knob');
            
            window.addEventListener('touchstart', e => {
                for(let t of e.changedTouches) {
                    if(t.clientX < window.innerWidth/2) touchIds.move = t.identifier;
                    else { touchIds.look = t.identifier; touchIds.lx = t.clientX; touchIds.ly = t.clientY; }
                }
            });

            window.addEventListener('touchmove', e => {
                for(let t of e.changedTouches) {
                    if(t.identifier === touchIds.move) {
                        let dx = t.clientX - 100, dy = t.clientY - (window.innerHeight - 100);
                        let ang = Math.atan2(dy, dx);
                        let dist = Math.min(Math.sqrt(dx*dx+dy*dy), 50);
                        knob.style.transform = `translate(${Math.cos(ang)*dist}px, ${Math.sin(ang)*dist}px)`;
                        move.x = Math.cos(ang)*(dist/50); move.y = -Math.sin(ang)*(dist/50);
                    }
                    if(t.identifier === touchIds.look) {
                        look.x -= (t.clientX - touchIds.lx) * 0.2;
                        look.y -= (t.clientY - touchIds.ly) * 0.2;
                        touchIds.lx = t.clientX; touchIds.ly = t.clientY;
                    }
                }
            });

            window.addEventListener('touchend', e => {
                for(let t of e.changedTouches) {
                    if(t.identifier === touchIds.move) { touchIds.move = null; move.x=0; move.y=0; knob.style.transform='translate(0,0)'; }
                    if(t.identifier === touchIds.look) touchIds.look = null;
                }
            });

            document.getElementById('jump-btn').ontouchstart = () => { if(jumps < 2) { velY = 0.3; jumps++; } };
            document.getElementById('shoot-btn').ontouchstart = () => shoot();
            document.getElementById('start-btn').onclick = () => { document.getElementById('start-screen').style.display='none'; isPlaying=true; init(); };
        }

        function loop() {
            requestAnimationFrame(loop);
            if(!isPlaying) return;

            // Camera Look
            look.y = Math.max(-80, Math.min(80, look.y));
            camera.rotation.order = 'YXZ';
            camera.rotation.y = THREE.MathUtils.degToRad(look.x);
            camera.rotation.x = THREE.MathUtils.degToRad(look.y);

            // Player Physics
            const fwd = new THREE.Vector3(0,0,-1).applyAxisAngle(new THREE.Vector3(0,1,0), camera.rotation.y);
            const rgt = new THREE.Vector3(1,0,0).applyAxisAngle(new THREE.Vector3(0,1,0), camera.rotation.y);
            camera.position.add(fwd.multiplyScalar(move.y * 0.2));
            camera.position.add(rgt.multiplyScalar(move.x * 0.2));

            velY -= 0.01; camera.position.y += velY;

            platforms.forEach(p => {
                const b = p.userData;
                if(camera.position.x > b.xMin && camera.position.x < b.xMax && camera.position.z > b.zMin && camera.position.z < b.zMax) {
                    if(camera.position.y < b.y + 1.5 && camera.position.y > b.y) {
                        camera.position.y = b.y + 1.5; velY = 0; jumps = 0;
                    }
                }
            });

            // Enemy AI (Gravity + Chase)
            enemies.forEach(m => {
                m.userData.velY -= 0.01; m.position.y += m.userData.velY;
                platforms.forEach(p => {
                    const b = p.userData;
                    if(m.position.x > b.xMin && m.position.x < b.xMax && m.position.z > b.zMin && m.position.z < b.zMax) {
                        if(m.position.y < b.y + 1 && m.position.y > b.y - 1) { m.position.y = b.y + 0.5; m.userData.velY = 0; }
                    }
                });
                
                let d = m.position.distanceTo(camera.position);
                if(d < 30) {
                    m.lookAt(camera.position.x, m.position.y, camera.position.z);
                    m.translateZ(m.userData.speed);
                }
                if(d < 1.5) { hp -= 0.5; document.getElementById('hp').innerText = Math.floor(hp); }
            });

            // Bullets
            for(let i=bullets.length-1; i>=0; i--) {
                let b = bullets[i]; b.position.add(b.userData.v);
                enemies.forEach((m, mi) => {
                    if(b.position.distanceTo(m.position) < 1.5) {
                        m.userData.hp--; 
                        scene.remove(b); bullets.splice(i,1);
                        if(m.userData.hp <= 0) { scene.remove(m); enemies.splice(mi, 1); }
                    }
                });
                if(b && b.position.distanceTo(camera.position) > 100) { scene.remove(b); bullets.splice(i, 1); }
            }

            muzzleFlash.intensity *= 0.8;
            renderer.render(scene, camera);
            if(hp <= 0) location.reload();
        }
    </script>
</body>
</html>
