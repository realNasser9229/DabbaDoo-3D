<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DABBADOO RESCUE</title>
    <style>
        body { margin: 0; overflow: hidden; background: #111; touch-action: none; font-family: sans-serif; }
        #ui { position: absolute; top: 10px; left: 10px; color: #fff; z-index: 10; pointer-events: none; }
        .stat { font-size: 18px; font-weight: bold; background: rgba(0,0,0,0.5); padding: 5px; border-radius: 5px; margin-bottom: 5px; }
        
        /* Crosshair */
        #cross { position: absolute; top: 50%; left: 50%; width: 20px; height: 20px; transform: translate(-50%, -50%); border: 2px solid #0f0; border-radius: 50%; pointer-events: none; }

        /* Controls */
        .btn { position: absolute; background: rgba(255,255,255,0.2); border: 2px solid #fff; border-radius: 50%; color: #fff; display: flex; align-items: center; justify-content: center; font-weight: bold; z-index: 20; }
        #joy-base { width: 120px; height: 120px; bottom: 30px; left: 30px; border-radius: 50%; background: rgba(0,0,0,0.3); border: 1px solid #fff; }
        #joy-knob { width: 50px; height: 50px; background: #fff; border-radius: 50%; position: absolute; top: 35px; left: 35px; }
        #btn-jump { width: 80px; height: 80px; bottom: 130px; right: 30px; background: #44f; }
        #btn-shoot { width: 100px; height: 100px; bottom: 20px; right: 20px; background: #f44; }

        #popup { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.9); color: #fff; padding: 40px; border: 4px solid #0f0; display: none; text-align: center; z-index: 100; font-size: 30px; }
    </style>
</head>
<body>
    <div id="ui">
        <div class="stat">VULVIAN LEVEL: <span id="vlvl">1</span></div>
        <div class="stat">HP: <span id="hp">100</span></div>
    </div>
    <div id="cross"></div>
    <div id="popup">THX BRO!</div>

    <div id="joy-base"><div id="joy-knob"></div></div>
    <div id="btn-jump" class="btn">JUMP</div>
    <div id="btn-shoot" class="btn">SHOOT</div>

    <script src="https://unpkg.com/three@0.155.0/build/three.min.js"></script>
    <script>
        let scene, camera, renderer, gun, clock;
        let platforms = [], enemies = [], bullets = [];
        let move = { f: 0, r: 0 }, look = { lon: 0, lat: 0 }, velY = 0;
        let tData = { lookId: null, moveId: null, lx: 0, ly: 0 };
        let hp = 100, level = 1, vLevel = 1, boobi, cage;

        init();
        animate();

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x111122);
            clock = new THREE.Clock();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            const light = new THREE.HemisphereLight(0xffffff, 0x444466, 1);
            scene.add(light);

            // Simple Weapon
            gun = new THREE.Mesh(new THREE.BoxGeometry(0.2, 0.2, 0.8), new THREE.MeshStandardMaterial({color: 0x333}));
            gun.position.set(0.4, -0.3, -0.6);
            camera.add(gun);
            scene.add(camera);

            setupLevel();
            setupEvents();
        }

        function setupLevel() {
            // Clear
            platforms.forEach(p => scene.remove(p));
            enemies.forEach(e => scene.remove(e));
            if(cage) scene.remove(cage);
            platforms = []; enemies = [];

            camera.position.set(0, 5, 0);
            
            // Start
            spawnPlatform(0, 0, 0, 15, 15, 0x555555);

            // Linear path
            let curZ = -15;
            for(let i=0; i < 5 + level; i++) {
                let x = (Math.random() - 0.5) * 10;
                let y = i * 1.5;
                spawnPlatform(x, y, curZ, 10, 10, 0x3366ff);
                if(i > 1) spawnEnemy(x, y + 2, curZ);
                curZ -= 15;
            }

            // Goal
            spawnPlatform(0, (5+level)*1.5, curZ, 12, 12, 0x00ff00);
            cage = new THREE.Mesh(new THREE.BoxGeometry(4, 5, 4), new THREE.MeshStandardMaterial({color: 0xfff, wireframe: true}));
            cage.position.set(0, (5+level)*1.5 + 2.5, curZ);
            boobi = new THREE.Mesh(new THREE.SphereGeometry(1), new THREE.MeshStandardMaterial({color: 0xff0000}));
            boobi.position.copy(cage.position);
            scene.add(cage, boobi);
        }

        function spawnPlatform(x, y, z, w, d, col) {
            const p = new THREE.Mesh(new THREE.BoxGeometry(w, 1, d), new THREE.MeshStandardMaterial({color: col}));
            p.position.set(x, y, z);
            scene.add(p);
            platforms.push(p);
        }

        function spawnEnemy(x, y, z) {
            const e = new THREE.Mesh(new THREE.BoxGeometry(2, 2, 2), new THREE.MeshStandardMaterial({color: 0xffaa00}));
            e.position.set(x, y, z);
            e.userData = { hp: 2 };
            scene.add(e);
            enemies.push(e);
        }

        function setupEvents() {
            const joy = document.getElementById('joy-base'), knob = document.getElementById('joy-knob');
            window.ontouchstart = e => {
                for(let t of e.changedTouches) {
                    if (t.clientX > window.innerWidth/2) { tData.lookId = t.identifier; tData.lx = t.clientX; tData.ly = t.clientY; }
                    let r = joy.getBoundingClientRect();
                    if (t.clientX > r.left && t.clientX < r.right && t.clientY > r.top && t.clientY < r.bottom) tData.moveId = t.identifier;
                }
            };
            window.ontouchmove = e => {
                for(let t of e.changedTouches) {
                    if (t.identifier === tData.lookId) {
                        look.lon -= (t.clientX - tData.lx) * 0.4;
                        look.lat -= (t.clientY - tData.ly) * 0.4;
                        tData.lx = t.clientX; tData.ly = t.clientY;
                    }
                    if (t.identifier === tData.moveId) {
                        let r = joy.getBoundingClientRect(), dx = t.clientX-(r.left+60), dy = t.clientY-(r.top+60);
                        let d = Math.min(Math.sqrt(dx*dx+dy*dy), 50);
                        let a = Math.atan2(dy, dx);
                        knob.style.transform = `translate(${Math.cos(a)*d}px, ${Math.sin(a)*d}px)`;
                        move.f = -Math.sin(a)*(d/50); move.r = Math.cos(a)*(d/50);
                    }
                }
            };
            window.ontouchend = e => {
                for(let t of e.changedTouches) {
                    if (t.identifier === tData.moveId) { move.f = 0; move.r = 0; knob.style.transform = `translate(0,0)`; }
                }
            };
            document.getElementById('btn-jump').ontouchstart = e => { e.preventDefault(); if(velY === 0) velY = 0.3; };
            document.getElementById('btn-shoot').ontouchstart = e => { e.preventDefault(); shoot(); };
        }

        function shoot() {
            const b = new THREE.Mesh(new THREE.SphereGeometry(0.2), new THREE.MeshBasicMaterial({color: 0xffff00}));
            b.position.copy(camera.position);
            const dir = new THREE.Vector3(0,0,-1).applyQuaternion(camera.quaternion);
            b.userData.v = dir.multiplyScalar(2);
            scene.add(b); bullets.push(b);
        }

        function animate() {
            requestAnimationFrame(animate);
            look.lat = Math.max(-85, Math.min(85, look.lat));
            camera.rotation.order = 'YXZ';
            camera.rotation.y = THREE.MathUtils.degToRad(look.lon);
            camera.rotation.x = THREE.MathUtils.degToRad(look.lat);

            let mDir = new THREE.Vector3(move.r, 0, -move.f).applyQuaternion(new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0), camera.rotation.y));
            camera.position.add(mDir.multiplyScalar(0.2));

            velY -= 0.015;
            camera.position.y += velY;

            platforms.forEach(p => {
                if (Math.abs(camera.position.x - p.position.x) < 5 && Math.abs(camera.position.z - p.position.z) < 5 && camera.position.y > p.position.y + 1 && camera.position.y < p.position.y + 2.5) {
                    camera.position.y = p.position.y + 1.8;
                    velY = 0;
                }
            });

            if(camera.position.y < -20) { hp -= 10; camera.position.set(0, 5, 0); document.getElementById('hp').innerText = hp; }

            bullets.forEach((b, i) => {
                b.position.add(b.userData.v);
                enemies.forEach((e, j) => {
                    if(b.position.distanceTo(e.position) < 2) {
                        scene.remove(e); enemies.splice(j, 1);
                        scene.remove(b); bullets.splice(i, 1);
                    }
                });
            });

            if(boobi && camera.position.distanceTo(boobi.position) < 4) {
                win();
            }

            renderer.render(scene, camera);
        }

        function win() {
            boobi = null;
            level++; vLevel++;
            document.getElementById('vlvl').innerText = vLevel;
            const p = document.getElementById('popup');
            p.style.display = 'block';
            setTimeout(() => { p.style.display = 'none'; setupLevel(); }, 2000);
        }
    </script>
</body>
</html>
        
