<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DABBADOO DELUXE - Dr. RagorGaming Edition</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; touch-action: none; font-family: 'Courier New', Courier, monospace; }
        #ui { position: absolute; top: 20px; left: 20px; color: #fff; z-index: 100; pointer-events: none; }
        .stat { font-size: 28px; font-weight: 900; text-shadow: 3px 3px #f00; letter-spacing: 1px; color: #0f0; margin-bottom: 5px; }
        #cake-warning { position: absolute; top: 10%; width: 100%; text-align: center; color: #f00; font-weight: bold; font-size: 20px; opacity: 0.7; pointer-events: none; animation: flicker 2s infinite; }
        @keyframes flicker { 0%,100% { opacity: 0.7; } 50% { opacity: 0.3; } }
        
        /* Crosshair */
        #crosshair { position: absolute; top: 50%; left: 50%; width: 40px; height: 40px; border: 2px solid #0f0; transform: translate(-50%, -50%); z-index: 50; }
        #crosshair:before { content: ''; position: absolute; top: 50%; left: 0; width: 100%; height: 2px; background: #0f0; }
        #crosshair:after { content: ''; position: absolute; left: 50%; top: 0; width: 2px; height: 100%; background: #0f0; }

        /* Buttons */
        .btn { position: absolute; border-radius: 50%; background: rgba(50,50,50,0.9); border: 4px solid #fff; display: flex; align-items: center; justify-content: center; color: #fff; z-index: 100; font-weight: bold; text-shadow: 2px 2px #000; }
        #joy-base { width: 140px; height: 140px; bottom: 40px; left: 40px; background: rgba(255,255,255,0.1); border: 3px solid #555; border-radius: 50%; position: absolute; }
        #joy-knob { width: 70px; height: 70px; background: #f00; border-radius: 50%; position: absolute; top: 35px; left: 35px; box-shadow: 0 0 30px #f00; transition: transform 0.05s; }
        
        #jump-btn { width: 100px; height: 100px; bottom: 200px; right: 40px; background: #00f; font-size: 18px; }
        #shoot-btn { width: 140px; height: 140px; bottom: 20px; right: 30px; font-size: 28px; background: #f00; border-color: #ff0; animation: pulse 0.8s infinite; }
        
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        
        #reload-msg { position: absolute; bottom: 30%; left: 50%; transform: translateX(-50%); color: #0f0; font-size: 48px; font-weight: 900; display: none; text-shadow: 0 0 30px #0f0; animation: bounce 0.5s infinite; }
        @keyframes bounce { 0%,100% { transform: translateX(-50%) translateY(0); } 50% { transform: translateX(-50%) translateY(-20px); } }

        #win-msg { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #0ff; font-size: 60px; font-weight: 900; text-shadow: 0 0 40px #0ff; display: none; z-index: 200; animation: winpulse 1s infinite; }
        @keyframes winpulse { 0% { transform: translate(-50%, -50%) scale(1); } 50% { transform: translate(-50%, -50%) scale(1.2); } 100% { transform: translate(-50%, -50%) scale(1); } }
    </style>
</head>
<body>
    <div id="cake-warning">THE CAKE IS A LIE. THE CAKE IS A LIE.</div>
    <div id="ui">
        <div class="stat">SIGMA SCORE: <span id="sc">0</span></div>
        <div class="stat">KILLS: <span id="kills">0</span></div>
        <div class="stat">AMMO: <span id="am">12/12</span></div>
        <div class="stat" style="color: #0ff;">BROTHER STATUS: <span id="brother-status">NEEDS RESCUE</span></div>
    </div>
    
    <div id="reload-msg">SNEEZING DABBADOO...</div>
    <div id="win-msg">THX BRO<br>VULVIAN WINS<br>YABBA DABBA DOO!!</div>
    <div id="crosshair"></div>
    <div id="joy-base"><div id="joy-knob"></div></div>
    <div id="jump-btn" class="btn">DOUBLE<br>JUMP</div>
    <div id="shoot-btn" class="btn">GRIND</div>

    <script src="https://unpkg.com/three@0.155.0/build/three.min.js"></script>
    <script>
        let scene, camera, renderer, gun, clock;
        let bullets = [], enemies = [], snotParticles = [];
        let score = 0, kills = 0, ammo = 12, reloading = false, jumps = 0;
        let brotherBarrier = null, brotherSaved = false;
        
        const SENSITIVITY = 0.4;
        let move = { f: 0, r: 0 }, look = { lon: 0, lat: 0 }, velY = 0;
        let tData = { lookId: null, moveId: null, lx: 0, ly: 0 };

        init();
        animate();

        function createFaceTexture(isEvil = false) {
            const canvas = document.createElement('canvas');
            canvas.width = 64; canvas.height = 64;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#ffffff'; ctx.fillRect(0,0,64,64);
            ctx.fillStyle = '#000000';
            ctx.fillRect(15, 18, 10, 12); ctx.fillRect(39, 18, 10, 12);
            ctx.beginPath();
            if(isEvil) ctx.moveTo(12, 45), ctx.quadraticCurveTo(32, 55, 52, 45);
            else ctx.moveTo(12, 45), ctx.quadraticCurveTo(32, 35, 52, 45);
            ctx.lineWidth = 5; ctx.stroke();
            return new THREE.CanvasTexture(canvas);
        }

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x111122);
            scene.fog = new THREE.FogExp2(0x111122, 0.015);
            clock = new THREE.Clock();
            
            camera = new THREE.PerspectiveCamera(80, window.innerWidth/window.innerHeight, 0.1, 200);
            camera.position.y = 1.7;
            
            renderer = new THREE.WebGLRenderer({ antialias: false });
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            const light = new THREE.DirectionalLight(0xaaaaaa, 1.5);
            light.position.set(5, 15, 10);
            scene.add(light, new THREE.AmbientLight(0x404060, 1));

            const ground = new THREE.Mesh(new THREE.PlaneGeometry(200, 200), new THREE.MeshStandardMaterial({color: 0x222233}));
            ground.rotation.x = -Math.PI/2;
            ground.position.y = -0.1;
            scene.add(ground);

            for(let i = 0; i < 30; i++) {
                const plat = new THREE.Mesh(new THREE.BoxGeometry(8 + Math.random()*12, 0.5, 8 + Math.random()*12), new THREE.MeshStandardMaterial({color: 0x444455}));
                plat.position.set(Math.random()*100-50, Math.random()*5, Math.random()*-100-20);
                scene.add(plat);
            }

            brotherBarrier = new THREE.Mesh(new THREE.BoxGeometry(6, 8, 1), new THREE.MeshStandardMaterial({color: 0x888888, transparent: true, opacity: 0.6}));
            brotherBarrier.position.set(0, 4, -80);
            scene.add(brotherBarrier);

            const boobi = new THREE.Group();
            const boobiBody = new THREE.Mesh(new THREE.BoxGeometry(2, 3, 1), new THREE.MeshStandardMaterial({color: 0x3366ff}));
            const boobiHead = new THREE.Mesh(new THREE.BoxGeometry(1.5, 1.5, 1.5), new THREE.MeshStandardMaterial({map: createFaceTexture(false)}));
            boobiHead.position.y = 2;
            const flower = new THREE.Mesh(new THREE.CylinderGeometry(0.6, 0.6, 0.2), new THREE.MeshStandardMaterial({color: 0xffff00}));
            flower.position.set(0, 3.2, 0);
            boobi.add(boobiBody, boobiHead, flower);
            boobi.position.set(0, 1, -79.5);
            scene.add(boobi);

            gun = new THREE.Group();
            const gunBody = new THREE.Mesh(new THREE.BoxGeometry(0.2, 0.25, 1), new THREE.MeshStandardMaterial({color: 0x222222}));
            const barrel = new THREE.Mesh(new THREE.CylinderGeometry(0.05, 0.05, 0.8), new THREE.MeshStandardMaterial({color: 0x111111}));
            barrel.rotation.x = Math.PI/2; barrel.position.z = -0.6;
            gun.add(gunBody, barrel);
            gun.position.set(0.4, -0.4, -0.8);
            camera.add(gun);
            scene.add(camera);

            for(let i=0; i<15; i++) spawnBoobasta();

            setupTouch();
        }

        function spawnBoobasta() {
            const boobasta = new THREE.Group();
            const body = new THREE.Mesh(new THREE.BoxGeometry(1.8, 3, 1), new THREE.MeshStandardMaterial({color: 0x666666}));
            const head = new THREE.Mesh(new THREE.BoxGeometry(1.4, 1.4, 1.4), new THREE.MeshStandardMaterial({map: createFaceTexture(true)}));
            head.position.y = 2.2;
            const armL = new THREE.Mesh(new THREE.BoxGeometry(0.5, 2, 0.5), new THREE.MeshStandardMaterial({color: 0x666666}));
            armL.position.set(-1.2, 0.8, 0); armL.rotation.z = Math.PI/2;
            const armR = armL.clone(); armR.position.x = 1.2; armR.rotation.z = -Math.PI/2;
            
            boobasta.add(body, head, armL, armR);
            boobasta.position.set(Math.random()*80-40, 1.5, Math.random()*-80-20);
            boobasta.userData = { speed: 0.05 + Math.random()*0.05 };
            scene.add(boobasta);
            enemies.push(boobasta);
        }

        function spawnSnot() {
            for(let i=0; i<10; i++) {
                const p = new THREE.Mesh(new THREE.SphereGeometry(0.15), new THREE.MeshBasicMaterial({color: 0x00ff00, transparent: true, opacity: 0.8}));
                p.position.copy(gun.position).applyQuaternion(camera.quaternion);
                const dir = new THREE.Vector3(0,0,-1).applyQuaternion(camera.quaternion);
                p.userData.v = dir.clone().multiplyScalar(0.4 + Math.random()*0.3).add(new THREE.Vector3((Math.random()-0.5)*0.4, (Math.random()-0.5)*0.4, 0));
                p.userData.life = 1.5;
                scene.add(p); snotParticles.push(p);
            }
        }

        function setupTouch() {
            const joy = document.getElementById('joy-base'), knob = document.getElementById('joy-knob');
            window.ontouchstart = e => {
                for(let t of e.changedTouches) {
                    if (t.clientX > window.innerWidth/2) { tData.lookId = t.identifier; tData.lx = t.clientX; tData.ly = t.clientY; }
                    let r = joy.getBoundingClientRect();
                    if (t.clientX > r.left && t.clientX < r.right && t.clientY > r.top && t.clientY < r.bottom) tData.moveId = t.identifier;
                }
            };
            window.ontouchmove = e => {
                e.preventDefault();
                for(let t of e.changedTouches) {
                    if (t.identifier === tData.lookId) {
                        look.lon -= (t.clientX - tData.lx) * SENSITIVITY;
                        look.lat -= (t.clientY - tData.ly) * SENSITIVITY;
                        look.lat = Math.max(-85, Math.min(85, look.lat));
                        tData.lx = t.clientX; tData.ly = t.clientY;
                    }
                    if (t.identifier === tData.moveId) {
                        let r = joy.getBoundingClientRect(), dx = t.clientX - (r.left + 70), dy = t.clientY - (r.top + 70);
                        let dist = Math.min(Math.sqrt(dx*dx + dy*dy), 70);
                        let angle = Math.atan2(dy, dx);
                        knob.style.transform = `translate(${dist * Math.cos(angle)}px, ${dist * Math.sin(angle)}px)`;
                        move.f = -Math.sin(angle) * (dist / 70);
                        move.r = Math.cos(angle) * (dist / 70);
                    }
                }
            };
            window.ontouchend = e => {
                for(let t of e.changedTouches) {
                    if (t.identifier === tData.lookId) tData.lookId = null;
                    if (t.identifier === tData.moveId) { tData.moveId = null; move.f = 0; move.r = 0; knob.style.transform = 'translate(0,0)'; }
                }
            };
            document.getElementById('shoot-btn').ontouchstart = e => { e.preventDefault(); shoot(); };
            document.getElementById('jump-btn').ontouchstart = e => { 
                e.preventDefault(); 
                if(jumps < 2) { velY = 0.3; jumps++; }
            };
        }

        function shoot() {
            if(reloading || ammo <= 0) return;
            ammo--; document.getElementById('am').innerText = ammo + "/12";
            
            const b = new THREE.Mesh(new THREE.SphereGeometry(0.15), new THREE.MeshBasicMaterial({color: 0xffff00}));
            b.position.copy(gun.position).applyQuaternion(camera.quaternion);
            b.userData.v = new THREE.Vector3(0,0,-2).applyQuaternion(camera.quaternion);
            scene.add(b); bullets.push(b);

            gun.position.z = -0.4;
            setTimeout(() => gun.position.z = -0.8, 80);

            if(ammo === 0) doReload();
        }

        function doReload() {
            reloading = true;
            document.getElementById('reload-msg').style.display = 'block';
            let interval = setInterval(spawnSnot, 80);
            setTimeout(() => {
                clearInterval(interval);
                ammo = 12; reloading = false;
                document.getElementById('am').innerText = "12/12";
                document.getElementById('reload-msg').style.display = 'none';
            }, 1800);
        }

        function checkWin() {
            if(camera.position.distanceTo(brotherBarrier.position) < 8 && !brotherSaved) {
                document.getElementById('win-msg').style.display = 'block';
                document.getElementById('brother-status').innerText = "SAVED - THX BRO";
                brotherSaved = true;
            }
        }

        function animate() {
            requestAnimationFrame(animate);
            const delta = clock.getDelta();

            camera.rotation.order = 'YXZ';
            camera.rotation.y = THREE.MathUtils.degToRad(look.lon);
            camera.rotation.x = THREE.MathUtils.degToRad(look.lat);

            camera.translateZ(move.f * delta * 20);
            camera.translateX(move.r * delta * 20);

            camera.position.y += velY * delta * 20;
            velY -= 0.5 * delta * 20;
            if(camera.position.y <= 1.7) { camera.position.y = 1.7; velY = 0; jumps = 0; }

            camera.position.x += (Math.random()-0.5) * 0.03;
            camera.position.z += (Math.random()-0.5) * 0.03;

            enemies.forEach(e => {
                const dir = camera.position.clone().sub(e.position).normalize();
                e.position.add(dir.multiplyScalar(e.userData.speed * 30 * delta));
                e.lookAt(camera.position);
            });

            for(let i=bullets.length-1; i>=0; i--) {
                const b = bullets[i];
                b.position.add(b.userData.v.clone().multiplyScalar(delta * 50));
                enemies.forEach((e, j) => {
                    if(b.position.distanceTo(e.position) < 2) {
                        scene.remove(e); enemies.splice(j,1);
                        kills++; document.getElementById('kills').innerText = kills;
                        score += 100; document.getElementById('sc').innerText = score;
                        spawnBoobasta();
                    }
                });
                if(b.position.length() > 200) { scene.remove(b); bullets.splice(i,1); }
            }

            snotParticles.forEach((p, i) => {
                p.position.add(p.userData.v.clone().multiplyScalar(delta * 20));
                p.userData.life -= delta;
                p.material.opacity = p.userData.life;
                if(p.userData.life <= 0) { scene.remove(p); snotParticles.splice(i,1); }
            });

            checkWin();
            renderer.render(scene, camera);
        }
    </script>
</body>
</html>
